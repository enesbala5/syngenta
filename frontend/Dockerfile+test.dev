FROM node:22-bookworm

WORKDIR /frontend

COPY package.json ./

# RUN npm config set fetch-retry-maxtimeout 600000 -g

RUN npm install

COPY . .

EXPOSE 5173

# -----------------------------------

ARG PORT
ARG DATABASE_URL
ARG RESEND_API_KEY
ARG PUBLIC_NODE_ENV
ARG PUBLIC_PAGE_URL
ARG PUBLIC_BACKEND_URL
ARG CURRENCY_API_KEY
ARG PUBLIC_UMAMI_SCRIPT
ARG PUBLIC_UMAMI_DATA_WEBSITE_ID
ARG OPENAI_API_KEY

ENV PORT=$PORT
ENV DATABASE_URL=$DATABASE_URL
ENV RESEND_API_KEY=$RESEND_API_KEY
ENV PUBLIC_NODE_ENV=$PUBLIC_NODE_ENV
ENV PUBLIC_PAGE_URL=$PUBLIC_PAGE_URL
ENV PUBLIC_BACKEND_URL=$PUBLIC_BACKEND_URL
ENV CURRENCY_API_KEY=$CURRENCY_API_KEY
ENV PUBLIC_UMAMI_SCRIPT=$PUBLIC_UMAMI_SCRIPT
ENV PUBLIC_UMAMI_DATA_WEBSITE_ID=$PUBLIC_UMAMI_DATA_WEBSITE_ID
ENV OPENAI_API_KEY=$OPENAI_API_KEY

# -----------------------------------

# RUN npm run generate-types

RUN npx prisma generate

RUN npx @sveltejs/kit sync

CMD ["npm", "run", "dev"]
